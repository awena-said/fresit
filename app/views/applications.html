{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/fresit/public/styles/staff.css">
{% endblock %}

{% block content %}
<section id="dashboard-section" class="dashboard-section">
    <div class="dashboard-header">
        <h1>STAFF DASHBOARD</h1>
        <div class="user-info">
            <span id="user-email">{{ user.email }}</span>
            <a href="/fresit/staff/logout" class="logout-btn">Logout</a>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
        <a href="/fresit/staff/applications" class="nav-tab active">Applications</a>
        <a href="/fresit/staff/classes" class="nav-tab">Manage Classes</a>
        <a href="/fresit/staff/schedule" class="nav-tab">Schedule Classes</a>
        <a href="/fresit/staff/roster" class="nav-tab">Class Roster</a>
        <a href="/fresit/staff/emails" class="nav-tab">Email Files</a>
    </div>

    <!-- Applications Content -->
    <div class="dashboard-content">
        <div class="content-header">
            <h2>Student Applications</h2>
            <div class="filter-controls">
                <a href="/fresit/staff/applications" class="filter-btn {% if current_status == 'all' %}active{% endif %}">All</a>
                <a href="/fresit/staff/applications?status=pending" class="filter-btn {% if current_status == 'pending' %}active{% endif %}">Pending</a>
                <a href="/fresit/staff/applications?status=accepted" class="filter-btn {% if current_status == 'accepted' %}active{% endif %}">Accepted</a>
                <a href="/fresit/staff/applications?status=rejected" class="filter-btn {% if current_status == 'rejected' %}active{% endif %}">Rejected</a>
            </div>
        </div>

        {% if applications %}
            <div class="applications-list">
                {% for application in applications %}
                    <div class="application-card">
                        <div class="application-header">
                            <div class="application-info">
                                <h3>{{ application.student_name }}</h3>
                                <div class="application-status {{ application.status }}">
                                    {{ application.status|title }}
                                </div>
                            </div>
                            <div class="application-date">
                                Submitted: {{ application.submitted_at|date('d M Y H:i') }}
                            </div>
                        </div>
                        
                        <div class="application-details">
                            <p><strong>Email:</strong> {{ application.student_email }}</p>
                            {% if application.student_phone %}
                                <p><strong>Phone:</strong> {{ application.student_phone }}</p>
                            {% endif %}
                            <p><strong>Class:</strong> {{ application.class_type_name }} with {{ application.tutor_name }}</p>
                            <p><strong>Time:</strong> {{ application.day_of_week }} {{ application.start_time|slice(0, 5) }}-{{ application.end_time|slice(0, 5) }}</p>
                            <p><strong>Start Date:</strong> {{ application.start_date|date('l, j F Y') }}</p>
                            <p><strong>Experience Level:</strong> {{ application.experience_level|title }}</p>
                            {% if application.additional_notes %}
                                <p><strong>Notes:</strong> {{ application.additional_notes }}</p>
                            {% endif %}
                        </div>

                        {% if application.status == 'pending' %}
                                                         <div class="application-actions">
                                 <button class="action-btn accept-btn" data-application-id="{{ application.id }}">
                                     <i class="fas fa-check"></i> Accept
                                 </button>
                                 <button class="action-btn reject-btn" data-application-id="{{ application.id }}">
                                     <i class="fas fa-times"></i> Reject
                                 </button>
                                 <a href="/fresit/staff/applications/{{ application.id }}" class="action-btn view-btn">
                                     <i class="fas fa-eye"></i> View Details
                                 </a>
                             </div>
                                                 {% else %}
                             <div class="application-actions">
                                 <a href="/fresit/staff/applications/{{ application.id }}" class="action-btn view-btn">
                                     <i class="fas fa-eye"></i> View Details
                                 </a>
                             </div>
                         {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <h3>No applications found</h3>
                <p>There are no applications matching the current filter.</p>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Accept application event listeners
    document.querySelectorAll('.accept-btn').forEach(button => {
        button.addEventListener('click', function() {
            const applicationId = this.getAttribute('data-application-id');
            acceptApplication(applicationId);
        });
    });

    // Reject application event listeners
    document.querySelectorAll('.reject-btn').forEach(button => {
        button.addEventListener('click', function() {
            const applicationId = this.getAttribute('data-application-id');
            rejectApplication(applicationId);
        });
    });
});

function acceptApplication(applicationId) {
    if (confirm('Are you sure you want to accept this application?')) {
        fetch('/staff/applications/' + applicationId + '/accept', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Application accepted successfully!');
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while processing the application.');
        });
    }
}

function rejectApplication(applicationId) {
    if (confirm('Are you sure you want to reject this application?')) {
        fetch('/staff/applications/' + applicationId + '/reject', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Application rejected successfully!');
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while processing the application.');
        });
    }
}
</script>
{% endblock %} 