{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/fresit/public/styles/staff.css">
{% endblock %}

{% block content %}
<section id="dashboard-section" class="dashboard-section">
    <div class="dashboard-header">
        <h1>STAFF DASHBOARD</h1>
        <div class="user-info">
            <span id="user-email">{{ user.email }}</span>
            <a href="/fresit/staff/logout" class="logout-btn">Logout</a>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
        <a href="/fresit/staff/applications" class="nav-tab">Applications</a>
        <a href="/fresit/staff/classes" class="nav-tab">Manage Classes</a>
        <a href="/fresit/staff/schedule" class="nav-tab">Schedule Classes</a>
        <a href="/fresit/staff/roster" class="nav-tab">Class Roster</a>
        <a href="/fresit/staff/emails" class="nav-tab active">Email Files</a>
    </div>

    <!-- Emails Content -->
    <div class="dashboard-content">
        <div class="content-header">
            <h2>Email Files</h2>
            <p>Generated email files for student communications</p>
        </div>

        <div class="emails-container">
            <div class="email-filters">
                <select id="emailTypeFilter" onchange="loadEmails()">
                    <option value="">All Email Types</option>
                    <option value="acceptance">Acceptance Emails</option>
                    <option value="rejection">Rejection Emails</option>
                    <option value="reminder">Reminder Emails</option>
                </select>
                
                <select id="dateFilter" onchange="loadEmails()">
                    <option value="">All Dates</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                </select>
            </div>

            <div id="emailsList" class="emails-list">
                <div class="empty-state">
                    <i class="fas fa-envelope"></i>
                    <h3>No email files found</h3>
                    <p>Email files will appear here when applications are processed.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadEmails();
});

function loadEmails() {
    const typeFilter = document.getElementById('emailTypeFilter').value;
    const dateFilter = document.getElementById('dateFilter').value;
    
    fetch(`/fresit/staff/api/emails?type=${typeFilter}&date=${dateFilter}`)
        .then(response => response.json())
        .then(data => {
            displayEmails(data.emails);
        })
        .catch(error => {
            console.error('Error loading emails:', error);
            displayEmails([]);
        });
}

function displayEmails(emails) {
    const emailsList = document.getElementById('emailsList');
    
    if (emails.length === 0) {
        emailsList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-envelope"></i>
                <h3>No email files found</h3>
                <p>Email files will appear here when applications are processed.</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    emails.forEach(email => {
        const emailTypeClass = email.type === 'acceptance' ? 'success' : 
                              email.type === 'rejection' ? 'error' : 'info';
        
        html += `
            <div class="email-item ${emailTypeClass}">
                <div class="email-header">
                    <div class="email-info">
                        <h4>${email.subject}</h4>
                        <p><strong>To:</strong> ${email.recipient}</p>
                        <p><strong>Type:</strong> ${email.type.charAt(0).toUpperCase() + email.type.slice(1)}</p>
                        <p><strong>Date:</strong> ${new Date(email.created_at).toLocaleString()}</p>
                    </div>
                    <div class="email-actions">
                        <button class="btn-secondary" onclick="viewEmail('${email.id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-secondary" onclick="downloadEmail('${email.id}')">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                </div>
            </div>
        `;
    });
    
    emailsList.innerHTML = html;
}

function viewEmail(emailId) {
    window.open(`/fresit/staff/emails/${emailId}/view`, '_blank');
}

function downloadEmail(emailId) {
    window.location.href = `/fresit/staff/emails/${emailId}/download`;
}
</script>
{% endblock %} 