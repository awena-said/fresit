{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/fresit/public/styles/staff.css">
{% endblock %}

{% block content %}
<section id="dashboard-section" class="dashboard-section">
    <div class="dashboard-header">
        <h1>STAFF DASHBOARD</h1>
        <div class="user-info">
            <span id="user-email">{{ user.email }}</span>
            <a href="/fresit/staff/logout" class="logout-btn">Logout</a>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
        <a href="/fresit/staff/applications" class="nav-tab">Applications</a>
        <a href="/fresit/staff/classes" class="nav-tab active">Manage Classes</a>
        <a href="/fresit/staff/schedule" class="nav-tab">Schedule Classes</a>
        <a href="/fresit/staff/roster" class="nav-tab">Class Roster</a>
        <a href="/fresit/staff/emails" class="nav-tab">Email Files</a>
    </div>

    <!-- Classes Content -->
    <div class="dashboard-content">
        <div class="content-header">
            <h2>Manage Classes</h2>
            <button class="btn-primary" onclick="showCreateClassForm()">Create New Class</button>
        </div>

        {% if classes %}
            <div class="classes-list">
                {% for class in classes %}
                    <div class="class-card">
                        <div class="class-header">
                            <h3>{{ class.name }}</h3>
                            <div class="class-status {{ class.status }}">
                                {{ class.status|title }}
                            </div>
                        </div>
                        
                        <div class="class-details">
                            <p><strong>Type:</strong> {{ class.type }}</p>
                            <p><strong>Tutor:</strong> {{ class.tutor_name }}</p>
                            <p><strong>Time:</strong> {{ class.day_of_week }} {{ class.start_time }}-{{ class.end_time }}</p>
                            <p><strong>Room:</strong> {{ class.room }}</p>
                            <p><strong>Capacity:</strong> {{ class.capacity }}</p>
                            <p><strong>Enrolled:</strong> {{ class.enrolled_count }}</p>
                        </div>

                        <div class="class-actions">
                            <button class="action-btn edit-btn" data-class-id="{{ class.id }}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="action-btn delete-btn" data-class-id="{{ class.id }}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <a href="/fresit/staff/roster?class_id={{ class.id }}" class="action-btn view-btn">
                                <i class="fas fa-users"></i> View Roster
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-chalkboard"></i>
                <h3>No classes found</h3>
                <p>Create your first class to get started.</p>
            </div>
        {% endif %}
    </div>
</section>

<!-- Create Class Modal -->
<div id="createClassModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create New Class</h2>
            <span class="close" onclick="closeCreateClassForm()">&times;</span>
        </div>
        <form id="createClassForm" method="POST" action="/fresit/staff/classes/create">
            <div class="form-group">
                <label for="class_name">Class Name *</label>
                <input type="text" id="class_name" name="class_name" required>
            </div>
            
            <div class="form-group">
                <label for="class_type">Class Type *</label>
                <select id="class_type" name="class_type" required>
                    <option value="">Select Type</option>
                    <option value="Foundation">Foundation</option>
                    <option value="Imagination">Imagination</option>
                    <option value="Watercolour">Watercolour</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="tutor_id">Tutor *</label>
                <select id="tutor_id" name="tutor_id" required>
                    <option value="">Select Tutor</option>
                    <!-- Tutors will be loaded via AJAX -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="day_of_week">Day of Week *</label>
                <select id="day_of_week" name="day_of_week" required>
                    <option value="">Select Day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start_time">Start Time *</label>
                    <input type="time" id="start_time" name="start_time" required>
                </div>
                
                <div class="form-group">
                    <label for="end_time">End Time *</label>
                    <input type="time" id="end_time" name="end_time" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="room">Room *</label>
                <input type="text" id="room" name="room" required>
            </div>
            
            <div class="form-group">
                <label for="capacity">Capacity *</label>
                <input type="number" id="capacity" name="capacity" min="1" max="20" required>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-primary">Create Class</button>
                <button type="button" class="btn-secondary" onclick="closeCreateClassForm()">Cancel</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showCreateClassForm() {
    document.getElementById('createClassModal').style.display = 'block';
    loadTutors();
}

function closeCreateClassForm() {
    document.getElementById('createClassModal').style.display = 'none';
}

function loadTutors() {
    // Load tutors via AJAX
    fetch('/fresit/staff/api/tutors')
        .then(response => response.json())
        .then(data => {
            const tutorSelect = document.getElementById('tutor_id');
            tutorSelect.innerHTML = '<option value="">Select Tutor</option>';
            
            data.tutors.forEach(tutor => {
                const option = document.createElement('option');
                option.value = tutor.id;
                option.textContent = tutor.name;
                tutorSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error loading tutors:', error);
        });
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('createClassModal');
    if (event.target === modal) {
        closeCreateClassForm();
    }
}
</script>
{% endblock %} 